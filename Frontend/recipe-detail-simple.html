<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Detail - Simple Test</title>
    <link rel="stylesheet" href="index.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .ingredients-section {
            margin: 30px 0;
        }
        .ingredients-list {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }
        .ingredient-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }
        .ingredient-name {
            font-weight: 500;
            color: #333;
        }
        .ingredient-quantity {
            color: #666;
            font-size: 0.9em;
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .test-controls {
            margin: 20px 0;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 8px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            color: #155724;
            background: #d4edda;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Recipe Detail - Ingredients Test</h1>
        
        <div class="test-controls">
            <h3>Test Controls</h3>
            <button onclick="loadMockRecipe()">Load Mock Recipe</button>
            <button onclick="testApiRecipe()">Test API Recipe</button>
            <button onclick="clearIngredients()">Clear Ingredients</button>
        </div>

        <div id="statusMessage"></div>

        <div class="ingredients-section">
            <h2><i class="fas fa-list-ul"></i> Ingredients</h2>
            <ul class="ingredients-list" id="ingredientsList">
                <li class="ingredient-item">
                    <span class="ingredient-name">Click "Load Mock Recipe" to test ingredients</span>
                </li>
            </ul>
        </div>
    </div>

    <script src="utils.js"></script>
    <script>
        // Simplified ingredient processor
        function renderIngredients(ingredients) {
            const ingredientsList = document.getElementById('ingredientsList');
            const statusMessage = document.getElementById('statusMessage');
            
            console.log('üçØ Rendering ingredients:', ingredients);
            
            if (!ingredients || !Array.isArray(ingredients) || ingredients.length === 0) {
                console.log('‚ùå No valid ingredients array found');
                ingredientsList.innerHTML = '<li class="ingredient-item"><span class="ingredient-name">No ingredients listed</span></li>';
                statusMessage.innerHTML = '<div class="error">No ingredients found in recipe data</div>';
                return;
            }

            console.log(`‚úÖ Processing ${ingredients.length} ingredients`);
            statusMessage.innerHTML = `<div class="success">Found ${ingredients.length} ingredients</div>`;

            const ingredientItems = ingredients.map((ingredient, index) => {
                let name, quantity = '';
                
                if (typeof ingredient === 'string') {
                    name = ingredient;
                    console.log(`String ingredient ${index + 1}: "${name}"`);
                } else if (typeof ingredient === 'object' && ingredient !== null) {
                    // Extract name - try common field names
                    name = ingredient.ingredient_name || 
                           ingredient.name || 
                           ingredient.title || 
                           ingredient.item ||
                           ingredient.display_name ||
                           (ingredient.ingredient && ingredient.ingredient.name) ||
                           (ingredient.ingredient && ingredient.ingredient.ingredient_name) ||
                           `Ingredient ${index + 1}`;
                    
                    // Extract quantity and unit
                    const qty = ingredient.quantity || ingredient.amount || ingredient.qty || '';
                    const unit = ingredient.unit || ingredient.units || ingredient.measurement || '';
                    
                    if (qty && unit) {
                        quantity = `${qty} ${unit}`;
                    } else if (qty) {
                        quantity = qty.toString();
                    }
                    
                    console.log(`Object ingredient ${index + 1}:`, { name, quantity, original: ingredient });
                } else {
                    name = `Unknown ingredient ${index + 1}`;
                    console.log(`Unknown ingredient type ${index + 1}:`, typeof ingredient);
                }

                return `
                    <li class="ingredient-item">
                        <span class="ingredient-name">${name}</span>
                        ${quantity ? `<span class="ingredient-quantity">${quantity}</span>` : ''}
                    </li>
                `;
            }).join('');

            ingredientsList.innerHTML = ingredientItems;
            console.log('‚úÖ Ingredients rendered successfully');
        }

        function loadMockRecipe() {
            console.log('üîÑ Loading mock recipe...');
            
            const mockRecipe = {
                id: 1,
                title: "Chicken Curry",
                ingredients: [
                    { ingredient_name: "Chicken breast", quantity: "500", unit: "g" },
                    { ingredient_name: "Coconut milk", quantity: "400", unit: "ml" },
                    { ingredient_name: "Onions", quantity: "2", unit: "medium" },
                    { ingredient_name: "Garlic cloves", quantity: "4", unit: "pieces" },
                    { ingredient_name: "Ginger", quantity: "1", unit: "inch" },
                    { ingredient_name: "Curry powder", quantity: "2", unit: "tbsp" },
                    { ingredient_name: "Turmeric", quantity: "1", unit: "tsp" },
                    { ingredient_name: "Salt", quantity: "1", unit: "tsp" },
                    { ingredient_name: "Vegetable oil", quantity: "2", unit: "tbsp" }
                ]
            };
            
            console.log('‚úÖ Mock recipe loaded:', mockRecipe);
            renderIngredients(mockRecipe.ingredients);
        }

        async function testApiRecipe() {
            console.log('üîÑ Testing API recipe...');
            
            try {
                const recipeAPI = new RecipeAPI();
                const recipe = await recipeAPI.getRecipe(1);
                
                console.log('‚úÖ API recipe loaded:', recipe);
                document.getElementById('statusMessage').innerHTML = '<div class="success">API recipe loaded successfully</div>';
                
                renderIngredients(recipe.ingredients);
            } catch (error) {
                console.error('‚ùå API error:', error);
                document.getElementById('statusMessage').innerHTML = `<div class="error">API Error: ${error.message}</div>`;
                
                // Fallback to mock
                console.log('üîÑ Falling back to mock data...');
                loadMockRecipe();
            }
        }

        function clearIngredients() {
            document.getElementById('ingredientsList').innerHTML = '<li class="ingredient-item"><span class="ingredient-name">Ingredients cleared</span></li>';
            document.getElementById('statusMessage').innerHTML = '';
        }

        // Auto-load mock recipe on page load
        window.addEventListener('load', function() {
            setTimeout(loadMockRecipe, 1000);
        });
    </script>
</body>
</html>
